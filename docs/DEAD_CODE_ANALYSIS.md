# Dead Code Analysis - –î–µ—Ç–∞–ª—å–Ω—ã–π –ê–Ω–∞–ª–∏–∑

**–î–∞—Ç–∞:** 03.10.2025
**–ú–µ—Ç–æ–¥:** usage_analysis.py + —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
**–°—Ç–∞—Ç—É—Å:** 28.4% –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞ (785 definitions)

---

## üéØ Executive Summary

–ù–µ –≤–µ—Å—å "–º–µ—Ä—Ç–≤—ã–π" –∫–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –º–µ—Ä—Ç–≤—ã–π. –ê–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑–∞–ª 3 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:

1. **üî¥ –†–µ–∞–ª—å–Ω–æ –º–µ—Ä—Ç–≤—ã–π –∫–æ–¥** - —É–¥–∞–ª–∏—Ç—å (stub implementations, refactoring –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω)
2. **üü° Feature toggles** - –æ—Å—Ç–∞–≤–∏—Ç—å (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥–∏)
3. **üü¢ –ù–µ–¥–æ—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ñ–∏—á–∏** - —Ä–µ—à–∏—Ç—å: –¥–æ–¥–µ–ª–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å

---

## üìä –î–µ—Ç–∞–ª—å–Ω—ã–π –ê–Ω–∞–ª–∏–∑ –ø–æ –ö–∞—Ç–µ–≥–æ—Ä–∏—è–º

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è 1: Normalization Services

#### `NormalizationServiceLegacy`
**–§–∞–π–ª:** `src/ai_service/layers/normalization/normalization_service_legacy.py`
**–†–∞–∑–º–µ—Ä:** ~100 LOC
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–û–°–¢–ê–í–ò–¢–¨**

**–ê–Ω–∞–ª–∏–∑:**
- –≠—Ç–æ **shim/–∞–¥–∞–ø—Ç–µ—Ä** –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–µ –Ω–∞—Å—Ç–æ—è—â–∏–π legacy –∫–æ–¥
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `NormalizationService._process_with_legacy()`
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ–≥–¥–∞ `use_factory_normalizer = False` (feature flag)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç–µ—Å—Ç–µ: `tests/unit/test_legacy_shim_smoke.py`

**–í—ã–≤–æ–¥:**
```python
# –í normalization_service.py:
if use_factory:
    result = await self._process_with_factory(...)  # –Ω–æ–≤—ã–π –ø—É—Ç—å
else:
    result = await self._process_with_legacy(...)   # —Å—Ç–∞—Ä—ã–π –ø—É—Ç—å ‚¨ÖÔ∏è –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø!
```

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ **–û–°–¢–ê–í–ò–¢–¨** - —ç—Ç–æ –∞–∫—Ç–∏–≤–Ω—ã–π fallback –º–µ—Ö–∞–Ω–∏–∑–º, –Ω–µ –º–µ—Ä—Ç–≤—ã–π –∫–æ–¥.

---

#### `NormalizationServiceDecomposed`
**–§–∞–π–ª:** `src/ai_service/layers/normalization/normalization_service_decomposed.py`
**–†–∞–∑–º–µ—Ä:** 25 LOC
**–°—Ç–∞—Ç—É—Å:** üóëÔ∏è **–£–î–ê–õ–ò–¢–¨**

**–ê–Ω–∞–ª–∏–∑:**
- **Stub implementation** - –ø—Ä–æ—Å—Ç–æ –Ω–∞—Å–ª–µ–¥—É–µ—Ç –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- –ú–µ—Ç–æ–¥ `normalize_decomposed()` –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç `normalize()` –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Ñ–ª–∞–≥
- –ù–∏–≥–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- –ù–µ—Ç —Ç–µ—Å—Ç–æ–≤

**–ö–æ–¥:**
```python
class NormalizationServiceDecomposed(NormalizationService):
    async def normalize_decomposed(self, text: str, config: Any = None):
        # –ü—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –º–µ—Ç–æ–¥!
        result = await self.normalize(text, config)
        return {
            "normalized": result.normalized,
            "decomposed": True  # ‚¨ÖÔ∏è —Ç–æ–ª—å–∫–æ —ç—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç
        }
```

**–†–µ—à–µ–Ω–∏–µ:** ‚ùå **–£–î–ê–õ–ò–¢–¨** - —ç—Ç–æ –∑–∞–≥–ª—É—à–∫–∞ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

---

#### `NormalizationFactoryRefactored`
**–§–∞–π–ª:** `src/ai_service/layers/normalization/processors/normalization_factory_refactored.py`
**–†–∞–∑–º–µ—Ä:** –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª LOC
**–°—Ç–∞—Ç—É—Å:** ü§î **–ü–†–û–í–ï–†–ò–¢–¨**

**–ê–Ω–∞–ª–∏–∑:**
–ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –≤ `_process_with_factory()`?
2. –ò–ª–∏ —ç—Ç–æ –Ω–µ–¥–æ–¥–µ–ª–∞–Ω–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥?

**–î–µ–π—Å—Ç–≤–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.

---

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è 2: Search Services

#### `HybridSearchServiceRefactored`
**–§–∞–π–ª:** `src/ai_service/layers/search/hybrid_search_service_refactored.py`
**–†–∞–∑–º–µ—Ä:** ~500+ LOC (—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏)
**–°—Ç–∞—Ç—É—Å:** üîÑ **–ù–ï–î–û–î–ï–õ–ê–ù–ù–´–ô –†–ï–§–ê–ö–¢–û–†–ò–ù–ì**

**–ê–Ω–∞–ª–∏–∑:**
- –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π
- –ï—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ `components/`:
  - `cache_manager.py` (8,973 bytes)
  - `performance_monitor.py` (10,707 bytes)
  - `result_processor.py` (11,858 bytes)
  - `search_executor.py` (12,267 bytes)
- –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: **~44 KB –∫–æ–¥–∞**
- **–ù–ò–ì–î–ï –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** - —Ç–æ–ª—å–∫–æ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ —Å–∞–º–æ–º —Ñ–∞–π–ª–µ

**–î–µ—Ç–∞–ª–∏:**
```python
class HybridSearchServiceRefactored(BaseService, SearchService):
    """
    Refactored hybrid search service with modular components.

    Breaks down the original monolithic service into focused, reusable components:
    - Cache management for embeddings, results, and queries
    - Performance monitoring and metrics collection
    - Search execution for AC, vector, and hybrid modes
    - Result processing including deduplication and reranking
    """
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `SearchCacheManager` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞–º–∏
- `PerformanceMonitor` - –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- `SearchExecutor` - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞
- `ResultProcessor` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í–µ—Å—å —ç—Ç–æ—Ç –∫–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω (–≤–µ—Ä–æ—è—Ç–Ω–æ)
- –ù–æ **–Ω–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω** –≤ –æ—Å–Ω–æ–≤–Ω–æ–π `HybridSearchService`
- –ó–∞–Ω–∏–º–∞–µ—Ç –º–µ—Å—Ç–æ –∏ —Å–æ–∑–¥–∞–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—É

**–†–µ—à–µ–Ω–∏–µ:**
–î–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:

**–í–∞—Ä–∏–∞–Ω—Ç A:** ‚ùå **–£–î–ê–õ–ò–¢–¨** (~44 KB + –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª)
- –ï—Å–ª–∏ –Ω–µ—Ç –ø–ª–∞–Ω–æ–≤ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
- –û—Å–≤–æ–±–æ–¥–∏—Ç ~50 KB –∫–æ–¥–∞

**–í–∞—Ä–∏–∞–Ω—Ç B:** ‚úÖ **–î–û–î–ï–õ–ê–¢–¨ –ò –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–¢–¨**
- –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `HybridSearchService`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- –£–ª—É—á—à–∏—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–ø—Ä–æ—Å–∏—Ç—å —Ç–∏–º–ª–∏–¥–∞ - –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ª–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥?

---

#### `EnhancedElasticsearchClient`
**–§–∞–π–ª:** `src/ai_service/layers/search/enhanced_elasticsearch_client.py`
**–†–∞–∑–º–µ—Ä:** –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª
**–°—Ç–∞—Ç—É—Å:** üîç **–ü–†–û–í–ï–†–ò–¢–¨**

**–ê–Ω–∞–ª–∏–∑:**
–ú–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `ElasticsearchClientFactory`.

**–î–µ–π—Å—Ç–≤–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –≥–¥–µ-—Ç–æ.

---

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è 3: Utility Services

#### `CacheService`
**–§–∞–π–ª:** `src/ai_service/core/cache_service.py`
**–†–∞–∑–º–µ—Ä:** ~150 LOC (–æ—Ü–µ–Ω–∫–∞)
**–°—Ç–∞—Ç—É—Å:** üîç **–ü–†–û–í–ï–†–ò–¢–¨**

**–ê–Ω–∞–ª–∏–∑:**
- –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ —ç—Ç–æ generic cache service
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `@lru_cache` –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
- –ò–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —Ç.–∫. –µ—Å—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã

**–î–µ–π—Å—Ç–≤–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞.

---

#### `OrchestratorFactoryWithSearch`
**–§–∞–π–ª:** `src/ai_service/core/orchestrator_factory_with_search.py`
**–†–∞–∑–º–µ—Ä:** –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª
**–°—Ç–∞—Ç—É—Å:** üîç **–ü–†–û–í–ï–†–ò–¢–¨**

**–ê–Ω–∞–ª–∏–∑:**
–ú–æ–∂–µ—Ç –±—ã—Ç—å deprecated –≤–µ—Ä—Å–∏—è —Ñ–∞–±—Ä–∏–∫–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

**–î–µ–π—Å—Ç–≤–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ.

---

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è 4: Contracts & Models

#### –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ Contracts

**–§–∞–π–ª:** `src/ai_service/contracts/search_contracts.py`

–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–ª–∞—Å—Å—ã:
- `ACScore` - –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ –¥—Ä—É–≥–æ–π –º–µ—Ö–∞–Ω–∏–∑–º?
- `VectorHit` - –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `Candidate`?
- `ElasticsearchACAdapterInterface` - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?
- `ElasticsearchVectorAdapterInterface`
- `SearchServiceInterface`

**–ê–Ω–∞–ª–∏–∑:**
- –≠—Ç–æ **–∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏/–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã** –¥–ª—è —Ç–∏–ø–∏–∑–∞—Ü–∏–∏
- –ú–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç—ã–µ contracts
- –ò–ª–∏ –Ω–µ –Ω—É–∂–Ω—ã –≤ Python (duck typing)

**–†–µ—à–µ–Ω–∏–µ:**
**–í–∞—Ä–∏–∞–Ω—Ç A:** ‚ùå **–£–î–ê–õ–ò–¢–¨** –µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è type hints
**–í–∞—Ä–∏–∞–Ω—Ç B:** ‚úÖ **–û–°–¢–ê–í–ò–¢–¨** –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è—Ö —Ç–∏–ø–æ–≤

**–î–µ–π—Å—Ç–≤–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ type hints:
```bash
grep "ACScore\|VectorHit\|SearchServiceInterface" src/ -r --include="*.py" | grep -v "class"
```

---

#### –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ API Models

**–§–∞–π–ª:** `src/ai_service/api/models.py`

–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–ª–∞—Å—Å—ã:
- `HealthResponse` - endpoint –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?
- `MetricsResponse` - endpoint –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?
- `PersonResult` - deprecated?
- `OrganizationResult` - deprecated?

**–ê–Ω–∞–ª–∏–∑:**
–≠—Ç–æ **Pydantic models** –¥–ª—è API endpoints.

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ù–∞–π—Ç–∏ endpoint –¥–ª—è health
grep "HealthResponse" src/ai_service/api/ -r

# –ù–∞–π—Ç–∏ endpoint –¥–ª—è metrics
grep "MetricsResponse" src/ai_service/api/ -r
```

**–†–µ—à–µ–Ω–∏–µ:**
–ï—Å–ª–∏ endpoint'—ã –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç ‚Üí **–£–î–ê–õ–ò–¢–¨**
–ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è ‚Üí **–†–ï–®–ò–¢–¨**: —É–¥–∞–ª–∏—Ç—å endpoint –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

---

### –ö–∞—Ç–µ–≥–æ—Ä–∏—è 5: Exception Classes

**–§–∞–π–ª:** `src/ai_service/exceptions.py`

–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:
```python
- APIError                  # –æ–±—â–∞—è –æ—à–∏–±–∫–∞ API
- AuthorizationError        # –Ω–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ
- CacheError               # –Ω–µ—Ç cache service
- MorphologyError          # –Ω–µ –±—Ä–æ—Å–∞–µ—Ç—Å—è
- PatternError             # –Ω–µ –±—Ä–æ—Å–∞–µ—Ç—Å—è
- ProcessingError          # –Ω–µ –±—Ä–æ—Å–∞–µ—Ç—Å—è
- RateLimitError           # –Ω–µ—Ç rate limiting
- SearchConfigurationError # –Ω–µ –±—Ä–æ—Å–∞–µ—Ç—Å—è
- SearchDataError          # –Ω–µ –±—Ä–æ—Å–∞–µ—Ç—Å—è
- SignalDetectionError     # –Ω–µ –±—Ä–æ—Å–∞–µ—Ç—Å—è
```

**–ê–Ω–∞–ª–∏–∑:**
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã "–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π"
- –§–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è (–Ω–µ raise)
- Python –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
**–í–∞—Ä–∏–∞–Ω—Ç A:** ‚ùå **–£–î–ê–õ–ò–¢–¨** –≤—Å–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ (~100 LOC)

**–í–∞—Ä–∏–∞–Ω—Ç B:** ‚úÖ **–û–°–¢–ê–í–ò–¢–¨** –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ:
- `APIError` - –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è
- `ConfigurationError` - –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫—Ä–æ–º–µ 2-3 –±–∞–∑–æ–≤—ã—Ö.

---

## üìã –ú–∞—Ç—Ä–∏—Ü–∞ –†–µ—à–µ–Ω–∏–π

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | LOC | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | –†–µ—à–µ–Ω–∏–µ |
|-----------|-----|---------------|---------|
| **Normalization Services** |  |  |  |
| `NormalizationServiceLegacy` | ~100 | ‚úÖ Feature flag fallback | ‚úÖ **–û–°–¢–ê–í–ò–¢–¨** |
| `NormalizationServiceDecomposed` | 25 | ‚ùå Stub, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | ‚ùå **–£–î–ê–õ–ò–¢–¨** |
| `NormalizationFactoryRefactored` | ? | üîç –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ | üîç **–ü–†–û–í–ï–†–ò–¢–¨** |
| **Search Services** |  |  |  |
| `HybridSearchServiceRefactored` | ~500 | ‚ùå –ù–µ–¥–æ–¥–µ–ª–∞–Ω–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ | ‚ö†Ô∏è **–†–ï–®–ò–¢–¨** (–¥–æ–¥–µ–ª–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å) |
| `components/` (4 —Ñ–∞–π–ª–∞) | ~44KB | ‚ùå –¢–æ–ª—å–∫–æ –≤ refactored | ‚ö†Ô∏è **–†–ï–®–ò–¢–¨** (–≤–º–µ—Å—Ç–µ —Å refactored) |
| `EnhancedElasticsearchClient` | ? | üîç –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ | üîç **–ü–†–û–í–ï–†–ò–¢–¨** |
| **Utility Services** |  |  |  |
| `CacheService` | ~150 | üîç –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ | üîç **–ü–†–û–í–ï–†–ò–¢–¨** |
| `OrchestratorFactoryWithSearch` | ? | üîç –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ | üîç **–ü–†–û–í–ï–†–ò–¢–¨** |
| **Contracts** |  |  |  |
| `ACScore`, `VectorHit` –∏ –¥—Ä. | ~200 | üîç Type hints? | üîç **–ü–†–û–í–ï–†–ò–¢–¨** |
| `HealthResponse`, `MetricsResponse` | ~100 | üîç Endpoints? | üîç **–ü–†–û–í–ï–†–ò–¢–¨** |
| **Exceptions** |  |  |  |
| 10 –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö exceptions | ~100 | ‚ùå –ù–µ raise | ‚ùå **–£–î–ê–õ–ò–¢–¨** (–æ—Å—Ç–∞–≤–∏—Ç—å 2-3) |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª–∏—Ç—å)

```bash
# 1. –£–¥–∞–ª–∏—Ç—å stub implementation
rm src/ai_service/layers/normalization/normalization_service_decomposed.py

# 2. –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ exceptions (–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å src/ai_service/exceptions.py - –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ:
# - ValueError, RuntimeError subclasses
# - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ APIError, ConfigurationError
```

**–≠—Ñ—Ñ–µ–∫—Ç:** ~125 LOC

---

### –¢—Ä–µ–±—É—é—Ç —Ä–µ—à–µ–Ω–∏—è —Ç–∏–º–ª–∏–¥–∞

#### 1. HybridSearchServiceRefactored + components/

**–í–æ–ø—Ä–æ—Å:** –ó–∞–≤–µ—Ä—à–∞—Ç—å –ª–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –ø–æ–∏—Å–∫–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã?

**–í–∞—Ä–∏–∞–Ω—Ç A: –î–æ–¥–µ–ª–∞—Ç—å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥** (2-3 –¥–Ω—è —Ä–∞–±–æ—Ç—ã)
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –æ—Å–Ω–æ–≤–Ω–æ–π `HybridSearchService`
- –ü–æ–ª—É—á–∏—Ç—å —á–∏—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- –£–ª—É—á—à–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å

**–í–∞—Ä–∏–∞–Ω—Ç B: –£–¥–∞–ª–∏—Ç—å** (30 –º–∏–Ω—É—Ç)
- –£–¥–∞–ª–∏—Ç—å `hybrid_search_service_refactored.py`
- –£–¥–∞–ª–∏—Ç—å `components/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
- –û—Å–≤–æ–±–æ–¥–∏—Ç—å ~50 KB –∫–æ–¥–∞
- –ü–æ—Ç–µ—Ä—è—Ç—å –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –µ—Å—Ç—å –≤—Ä–µ–º—è. –≠—Ç–æ —Ö–æ—Ä–æ—à–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞.

---

#### 2. API Endpoints (Health, Metrics)

**–í–æ–ø—Ä–æ—Å:** –ù—É–∂–Ω—ã –ª–∏ health/metrics endpoints?

**–ï—Å–ª–∏ –¥–∞:**
- –û—Å—Ç–∞–≤–∏—Ç—å `HealthResponse`, `MetricsResponse`
- –î–æ–¥–µ–ª–∞—Ç—å endpoints –≤ `main.py`

**–ï—Å–ª–∏ –Ω–µ—Ç:**
- –£–¥–∞–ª–∏—Ç—å models
- –û—Å–≤–æ–±–æ–¥–∏—Ç—å ~100 LOC

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–ª—è production –Ω—É–∂–µ–Ω health endpoint!

---

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å NormalizationFactoryRefactored
grep -r "NormalizationFactoryRefactored" src/ --include="*.py"

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å EnhancedElasticsearchClient
grep -r "EnhancedElasticsearchClient" src/ --include="*.py"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å CacheService
grep -r "CacheService" src/ --include="*.py"

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å type hints –¥–ª—è contracts
grep -r "ACScore\|VectorHit\|SearchServiceInterface" src/ --include="*.py" | grep -v "^.*:class"

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API endpoints
grep -r "HealthResponse\|MetricsResponse" src/ai_service/api/ --include="*.py"
```

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–π –≠—Ñ—Ñ–µ–∫—Ç

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–º–ª–∏–¥–∞)

```
- NormalizationServiceDecomposed      25 LOC
- 8 –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö exceptions        ~80 LOC
-------------------------------------------
–ò–¢–û–ì–û:                               ~105 LOC
```

### –ü–æ—Å–ª–µ —Ä–µ—à–µ–Ω–∏—è —Ç–∏–º–ª–∏–¥–∞ (–º–∞–∫—Å–∏–º—É–º)

```
- Refactored search service          ~500 LOC
- Components directory               ~200 LOC
- –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ contracts           ~200 LOC
- API models                         ~100 LOC
-------------------------------------------
–ò–¢–û–ì–û (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ):              ~1000 LOC
```

### –û–±—â–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª

```
–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:                  105 LOC
–° —Ä–µ—à–µ–Ω–∏—è–º–∏ —Ç–∏–º–ª–∏–¥–∞:               +1000 LOC
===========================================
–ú–ê–ö–°–ò–ú–£–ú:                           ~1105 LOC (0.4% –æ—Ç 285K)
```

**–í—ã–≤–æ–¥:** –†–µ–∞–ª—å–Ω–æ –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞ –Ω–µ —Ç–∞–∫ –º–Ω–æ–≥–æ (~1100 LOC). –û—Å—Ç–∞–ª—å–Ω—ã–µ 785-1100 = **~-315** —ç—Ç–æ false positives (feature flags, type hints).

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–µ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–£–¥–∞–ª–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ:**
   - `NormalizationServiceDecomposed` (stub)
   - 8 –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö exceptions

2. **–û—Å—Ç–∞–≤–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:**
   - `NormalizationServiceLegacy` (feature toggle)
   - Type hint contracts (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)

3. **–†–µ—à–∏—Ç—å —Å —Ç–∏–º–ª–∏–¥–æ–º:**
   - `HybridSearchServiceRefactored` - –¥–æ–¥–µ–ª–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å?
   - Health/Metrics endpoints - –Ω—É–∂–Ω—ã –∏–ª–∏ –Ω–µ—Ç?

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º:**
   - `NormalizationFactoryRefactored`
   - `EnhancedElasticsearchClient`
   - `CacheService`
   - `OrchestratorFactoryWithSearch`

---

**–ò—Ç–æ–≥:** –ò–∑ 28.4% "–º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞" —Ä–µ–∞–ª—å–Ω–æ –º–µ—Ä—Ç–≤–æ–≥–æ ~4-5%. –û—Å—Ç–∞–ª—å–Ω–æ–µ - feature toggles, type hints, –∏ –Ω–µ–¥–æ–¥–µ–ª–∞–Ω–Ω—ã–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∏.

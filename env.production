# MAXIMUM RELEVANCY CONFIGURATION
# Все флаги настроены для максимально релевантных результатов
# Приоритет: качество > скорость

# === CORE SERVICE SETTINGS ===
APP_ENV=production
WORKERS=4
DEBUG=false
SERVICE_HOST=0.0.0.0
SERVICE_PORT=8000

# === ELASTICSEARCH CONFIGURATION ===
ELASTICSEARCH_HOSTS=http://elasticsearch:9200
ELASTICSEARCH_HOST=elasticsearch
ELASTICSEARCH_PORT=9200
ES_HOSTS=elasticsearch:9200
ENABLE_ELASTICSEARCH_AUTH=false
ES_TIMEOUT=15  # Увеличен для полного поиска
ES_MAX_RETRIES=3
# SECURITY: Enable TLS certificate verification in production
ES_VERIFY_CERTS=true

# === QUALITY FIRST APPROACH ===
PRIORITIZE_QUALITY=true  # КАЧЕСТВО > СКОРОСТЬ
ENABLE_ACCURACY_MONITORING=true
MIN_CONFIDENCE_THRESHOLD=0.8  # Высокий порог качества
LOG_IMPLEMENTATION_CHOICE=true

# === SEARCH & RELEVANCY FEATURES ===
# Hybrid search - КРИТИЧНО для релевантности
ENABLE_SEARCH=true
ENABLE_HYBRID_SEARCH=true
ENABLE_ESCALATION=true
ESCALATION_THRESHOLD=0.7  # Снижен для лучшего покрытия
ENABLE_FALLBACK=true
FALLBACK_THRESHOLD=0.4   # Увеличен для качественного fallback

# AC search optimization
ENABLE_AHO_CORASICK=true
AHO_CORASICK_CONFIDENCE_BONUS=0.3
ENABLE_AC_TIER0=true

# Vector search для семантического поиска
ENABLE_VECTOR_FALLBACK=true
ENABLE_FAISS_INDEX=true
VECTOR_SIMILARITY_THRESHOLD=0.75  # Высокий порог для качества

# === VARIANTS & EMBEDDINGS ===
# Генерация вариантов - ВАЖНО для релевантности
ENABLE_VARIANTS=true
ENABLE_EMBEDDINGS=true  # Vector embeddings для семантики

# === DECISION ENGINE ===
ENABLE_DECISION_ENGINE=true

# Decision weights - оптимизированы для качества
AI_DECISION__W_SMARTFILTER=0.2   # Снижен
AI_DECISION__W_PERSON=0.35       # Увеличен для персон
AI_DECISION__W_ORG=0.2
AI_DECISION__W_SIMILARITY=0.35   # Увеличен для similarity
AI_DECISION__BONUS_DATE_MATCH=0.1
AI_DECISION__BONUS_ID_MATCH=0.15

# Search strategy weights - balanced
AI_DECISION__W_SEARCH_EXACT=0.25
AI_DECISION__W_SEARCH_PHRASE=0.25
AI_DECISION__W_SEARCH_NGRAM=0.25
AI_DECISION__W_SEARCH_VECTOR=0.4  # Увеличенный вес для vector поиска

# === ADVANCED NER & VALIDATION ===
# SpaCy NER для лучшего распознавания
ENABLE_SPACY_NER=true
ENABLE_SPACY_UK_NER=true
ENABLE_SPACY_EN_NER=true

# FSM role detection для точности
ENABLE_FSM_TUNED_ROLES=true

# === ENHANCED PROCESSING ===
# Улучшенные правила
ENABLE_ENHANCED_GENDER_RULES=true
ENABLE_ENHANCED_DIMINUTIVES=true
PRESERVE_FEMININE_SUFFIX_UK=true

# Качественная обработка имен
FIX_INITIALS_DOUBLE_DOT=true
PRESERVE_HYPHENATED_CASE=true
STRICT_STOPWORDS=true

# === DIMINUTIVES & CROSS-LANGUAGE ===
USE_DIMINUTIVES_DICTIONARY_ONLY=false  # ML + словарь
DIMINUTIVES_ALLOW_CROSS_LANG=true      # Кросс-языковые

# === NORMALIZATION QUALITY ===
NORMALIZATION_IMPLEMENTATION=factory
FACTORY_ROLLOUT_PERCENTAGE=100
USE_FACTORY_NORMALIZER=true

# Quality flags
NORMALIZATION_ENABLE_MORPHOLOGY=true
NORMALIZATION_ENABLE_ADVANCED_FEATURES=true
NORMALIZATION_PRESERVE_NAMES=true
NORMALIZATION_REMOVE_STOP_WORDS=true
NORMALIZATION_MAX_TOKENS=300  # Увеличено для полной обработки

# Advanced normalization
MORPHOLOGY_CUSTOM_RULES_FIRST=true
ENFORCE_NOMINATIVE=true
PRESERVE_FEMININE_SURNAMES=true

# === ENGLISH PROCESSING ===
ENABLE_NAMEPARSER_EN=true
ENABLE_EN_NICKNAMES=true
ENABLE_EN_NICKNAME_EXPANSION=true
FILTER_TITLES_SUFFIXES=true
EN_USE_NAMEPARSER=true

# === SMART FILTER BALANCED ===
ENABLE_SMART_FILTER=true
ALLOW_SMART_FILTER_SKIP=false  # НЕ пропускаем для качества

# ASCII processing
ENABLE_ASCII_FASTPATH=false  # Отключено для полной обработки

# === PERFORMANCE SETTINGS (BALANCED) ===
# Caching for quality
ENABLE_SEARCH_CACHE=true
SEARCH_CACHE_SIZE=8000
QUERY_CACHE_SIZE=12000
ENABLE_EMBEDDING_CACHE=true
EMBEDDING_CACHE_SIZE=4000
EMBEDDING_CACHE_TTL_SECONDS=10800  # 3 часа

# Connection settings
MAX_CONCURRENT_REQUESTS=50  # Снижено для качества
CONNECTION_POOL_SIZE=100
REQUEST_TIMEOUT_MS=10000    # Увеличен timeout
MAX_INPUT_LENGTH=8000       # Увеличено для полной обработки

# Performance thresholds
ENABLE_PERFORMANCE_FALLBACK=true
MAX_LATENCY_THRESHOLD_MS=200  # Увеличен для качества

# === LANGUAGE DETECTION PRECISION ===
LANG_MIN_CYR_RATIO=0.3    # Увеличено для точности
LANG_MIN_LAT_RATIO=0.3
LANG_MIXED_GAP=0.2        # Увеличено для консервативности
LANG_UK_CHARS_BONUS=0.08  # Увеличено
LANG_RU_CHARS_BONUS=0.08
LANG_MIN_CONFIDENCE=0.7   # Увеличено для качества

# === DEBUG & MONITORING ===
DEBUG_TRACING=false  # Отключено для production
ENABLE_DUAL_PROCESSING=false
ENABLE_METRICS=true
LOG_LEVEL=INFO

# === BUSINESS LOGIC ===
REQUIRE_TIN_DOB_GATE=true

# === SECURITY ===
# Generate with: python3 -c "import secrets; print(secrets.token_urlsafe(32))"
ADMIN_API_KEY=MyBJJBH4l8ntC29HgmZ9v5fVp1ilRIevV1jlinSRSRE
CORS_ORIGINS=["https://your-domain.com"]
RATE_LIMIT_ENABLED=true
MAX_REQUESTS_PER_MINUTE=6000  # 100 RPS

# === RESOURCE MANAGEMENT ===
CACHE_SIZE=3000
CACHE_TTL=5400  # 1.5 часа
MEMORY_LIMIT_MB=6144  # Увеличено для качества
CPU_LIMIT_PERCENT=90